{% extends 'layout.html' %}

{% block content %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<div class="container mt-4">

    <!-- =========================================================
         SECCIÓN: TÍTULO Y DATOS PRINCIPALES DE LA MASCOTA
         ---------------------------------------------------------
         TODO: Mostrar aquí el nombre de la mascota usando
               la variable de contexto 'mascota'.
         ========================================================= -->
    <h2>Galería de {{ mascota.nombre }}</h2>

    <hr>

    <!-- =========================================================
         SECCIÓN: LISTA / GALERÍA DE POSTS DE LA MASCOTA
         ---------------------------------------------------------
         CONTEXTO:
         - La vista envía una variable 'posts' con la lista de
           publicaciones (PostMascota) asociadas a esta mascota.

         OBJETIVO:
         - Recorrer 'posts' con un bucle for y mostrar cada post
           en una tarjeta (card) o bloque simple.
         
         Dentro del for, mostrar:
              - Título del post
              - Fecha del post
              - Descripción del post
              - Imagen del post (campo foto)

         REVISAR VISTA DE DETALLE DE MASCOTA COMO REFERENCIA
         ========================================================= -->
     
    <div class="row">
     {% for post in posts %}     
          <div class="col-md-6 col-lg-4">
               <div class="card shadow-sm h-100 border-0">
                    {% if mascota.foto %}
                         <img src="{{ post.foto.url }}" class="card-img-top" alt="{{ post.titulo }}">
                    {% else %}
                         <img src="https://via.placeholder.com/400x250?text=Mascota" class="card-img-top" alt="Sin foto">
                    {% endif %}

                    <div class="card-body">
                         <h5 class="card-title">{{ post.titulo }}</h5>
                         <p class="card-text text-muted">{{ post.descripcion|truncatewords:20 }}</p>
                         <p class="small text-secondary"><i class="bi bi-calender me-1"></i>{{ post.fecha }} </p>
                         <a type="button" href="{% url 'app1:eliminarPost' post.id %}" class="btn btn-light btn-icon">
                              <i class="bi bi-trash"></i>
                         </a>
                    </div>
               </div>
          </div>
          {% empty %}
          <p class="text-muted">No hay posts publicados aun.</p>
     {% endfor %}
    </div>
    

    <!-- =========================================================
         SECCIÓN: FORMULARIO PARA CREAR NUEVOS POSTS
         ---------------------------------------------------------
         CONTEXTO:
         - La vista, en la siguiente pregunta del examen, enviará
           un formulario 'form' basado en PostMascotaForm.

         OBJETIVO:
         - Mostrar el formulario dentro de la plantilla usando
           sintaxis de Django.
         ========================================================= -->

    <hr class="mt-4 mb-3">

    <h3>Registrar nuevo momento / publicación</h3>
    <!-- EJEMPLO COMENTADO (para que el alumno lo tome de guía):

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}





        <button type="submit" class="btn btn-primary mt-2">Guardar publicación</button>
    </form>

    -->

    <!-- =========================================================
         SECCIÓN: BOTÓN PARA VOLVER
         ---------------------------------------------------------
         TODO: Opcionalmente, los alumnos pueden agregar un enlace
               para regresar a la ruta home de la app1
         ========================================================= -->
     <form method="POST" action="{%  url 'app1:posts_mascota' mascota.id %}" enctype="multipart/form-data">
          {% csrf_token %}

          {% if form.non_field_errors %}
               <div class="alert alert-danger">
                    {{ form.non_field_errors }}
               </div>
          {% endif %}

          <div class="mb-3">
               {{ form.titulo.label_tag }}
               {{ form.titulo }}
               {% if form.titulo.errors %}
                    <div class="alert alert-danger">
                         {{ form.titulo.errors }}
                    </div>
               {% endif %}
          </div>
          <div class="mb-3">
               {{ form.fecha.label_tag }}
               {{ form.fecha }}
               {% if form.fecha.errors %}
                    <div class="alert alert-danger">
                         {{ form.fecha.errors }}
                    </div>
               {% endif %}
          </div>
          <div class="mb-3">
               {{ form.descripcion.label_tag }}
               {{ form.descripcion }}
               {% if form.descripcion.errors %}
                    <div class="alert alert-danger">
                         {{ form.descripcion.errors }}
                    </div>
               {% endif %}
          </div>
          <div class="mb-3">
               {{ form.foto.label_tag }}
               {{ form.foto }}
               {% if form.foto.errors %}
                    <div class="alert alert-danger">
                         {{ form.foto.errors }}
                    </div>
               {% endif %}
          </div>
          <button type="submit" class="btn btn-primary">
               <i class="fa-solid fa-check me-1"></i> Guardar
          </button>
          <a href="{% url 'app1:home' %}" class="btn btn-secondary">
               <i class="fa-solid fa-arrow-left me-1"></i> Cancelar
          </a>
     </form>
     <hr>
    <a href="{% url 'app1:home' %}" class="btn btn-secondary">Volver a inicio</a>


</div>
{% endblock %}
